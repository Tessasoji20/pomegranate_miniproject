<!DOCTYPE html>
{% load static %}
<html>
<head>
    <title>Post Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #2f303a;
            color: #000;
            font-family: Arial, sans-serif;
        }

        .top-bar {
            background: #ff4b3a;
            height: 64px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            color: white;
            font-size: 20px;
        }

        .card {
            background: #d1d1d3;
            margin: 20px;
            padding: 16px;
            border-radius: 12px;
        }

        .uploader {
            font-size: 12px;
            color: #555;
        }

        .title {
            font-size: 18px;
            font-weight: bold;
        }

        .desc {
            margin-top: 8px;
        }

        .actions {
            display: flex;
            gap: 18px;
            margin-top: 10px;
        }

        .actions i {
            cursor: pointer;
            font-size: 18px;
            color: #333;
        }

        .comments-title {
            text-align: center;
            color: white;
            margin-top: 24px;
            font-size: 20px;
        }

        .comment {
            background: #444;
            margin: 12px 20px;
            padding: 10px;
            border-radius: 10px;
            color: white;
        }

        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #ff4b3a;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            text-decoration: none;
        }
        .liked {
            color: red;
        }

        .saved {
            color: white;
        }

        .actions i {
            cursor: pointer;
            font-size: 20px;
            user-select: none;
        }
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal {
            background: white;
            padding: 20px;
            width: 300px;
            border-radius: 10px;
        }

        .modal h3 {
            margin-bottom: 10px;
        }

        .modal textarea {
            width: 100%;
            border: none;
            border-bottom: 1px solid #aaa;
            outline: none;
            resize: none;
            padding: 6px 0;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 16px;
        }

        .modal-actions button {
            background: none;
            border: none;
            color: #ff4b3a;
            font-weight: bold;
            cursor: pointer;
        }
        .comment {
    background: #3e3f46;
    margin: 10px 20px;
    padding: 12px 14px;
    border-radius: 10px;
    color: white;
}

.comment-meta {
    font-size: 12px;
    color: #bdbdbd;
    display: flex;
    gap: 8px;
    margin-bottom: 6px;
}

.comment-user {
    font-weight: 500;
}

.comment-date {
    opacity: 0.8;
}

.comment-text {
    font-size: 14px;
    line-height: 1.4;
}

.comment.empty {
    text-align: center;
    opacity: 0.7;
}
        .top-right {
            display: flex;
            gap: 22px;
        }

        .top-right i {
            cursor: pointer;
            font-size: 20px;
        }
     .top-bar {
            height: 64px;
            background-color: #ff4b3a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            color: #ffffff;
            font-size: 22px;
            font-weight: 500;
        }

        .top-left {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="top-left">
        <i class="fa fa-arrow-left" onclick="history.back()"></i>
        <span style="margin-left:12px;">Post Details</span>
    </div>

    <div class="top-right">
        <i class="fa-solid fa-rotate"
           title="Refresh"
           onclick="window.location.reload()"></i>

        <i class="fa-solid fa-house"
           title="Home"
           onclick="window.location.href='{% url 'app:dashboard' %}'"></i>
    </div>
</div>

<div class="card">
    <div class="uploader">{{ resource.uploaded_by.username|default:"Unknown user" }}
</div>
    <div class="title">{{ resource.title }}</div>
    <div class="desc">{{ resource.description }}</div>

    <div class="actions">
        <!-- LIKE -->
        <i id="like-btn"
           class="fa-heart {% if is_liked %}fa-solid liked{% else %}fa-regular{% endif %}"
           data-id="{{ resource.id }}">
            <span id="like-count">{{ likes_count }}</span>
        </i>

        <!-- LINK / FILE -->
        {% if resource.link %}
            <a href="{{ resource.link }}" target="_blank">
                <i class="fa-solid fa-link"></i>
            </a>
        {% elif resource.file %}
            <a href="{{ resource.file.url }}" download>
                <i class="fa-solid fa-link"></i>
            </a>
        {% endif %}

        <!-- SAVE -->
        <i id="save-btn"
           class="fa-bookmark {% if is_saved %}fa-solid saved{% else %}fa-regular{% endif %}"
           data-id="{{ resource.id }}">
        </i>
    </div>
</div>

<div class="comments-title">Comments</div>

<div id="comments-container">
    {% for comment in comments %}
        <div class="comment">

            <div class="comment-text mb-0" style=" margin-bottom: 12px;">
                {{ comment.text }}
            </div>
            <div class="comment-meta mt-1">
                <span class="comment-user">{{ comment.user.username }}</span>
                <span class="comment-date">
                    {{ comment.created_at|date:"Y-m-d" }}
                </span>
            </div>
        </div>
    {% empty %}
        <div class="comment empty">No comments yet.</div>
    {% endfor %}
</div>

<!-- ðŸ”½ ADD MODAL HERE (near bottom of file) -->
<div id="comment-modal" class="modal-overlay" style="display:none;">
    <div class="modal">
        <h3>Add Comment</h3>

        <textarea id="comment-text" placeholder="Write a comment.."></textarea>

        <div class="modal-actions">
            <button onclick="submitComment()">Post</button>
            <button onclick="closeCommentModal()">Cancel</button>
        </div>
    </div>
</div>

<!-- FLOATING COMMENT BUTTON -->
<a href="#" class="fab" onclick="openCommentModal()">
    <i class="fa fa-comment"></i>
</a>
<script>
const csrftoken = '{{ csrf_token }}';
const resourceId = '{{ resource.id }}';

/* ---------- LIKE ---------- */
const likeBtn = document.getElementById('like-btn');
if (likeBtn) {
    likeBtn.addEventListener('click', function () {
        fetch(`/resources/like/${resourceId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
            }
        })
        .then(res => res.json())
        .then(data => {
            likeBtn.classList.toggle('fa-solid', data.liked);
            likeBtn.classList.toggle('fa-regular', !data.liked);
            likeBtn.classList.toggle('liked', data.liked);
            document.getElementById('like-count').innerText = data.likes_count;
        });
    });
}

/* ---------- SAVE ---------- */
const saveBtn = document.getElementById('save-btn');
if (saveBtn) {
    saveBtn.addEventListener('click', function () {
        fetch(`/resources/save/${resourceId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
            }
        })
        .then(res => res.json())
        .then(data => {
            saveBtn.classList.toggle('fa-solid', data.saved);
            saveBtn.classList.toggle('fa-regular', !data.saved);
            saveBtn.classList.toggle('saved', data.saved);
        });
    });
}

/* ---------- COMMENT MODAL ---------- */
function openCommentModal() {
    document.getElementById('comment-modal').style.display = 'flex';
}

function closeCommentModal() {
    document.getElementById('comment-modal').style.display = 'none';
    document.getElementById('comment-text').value = '';
}

function submitComment() {
    const text = document.getElementById('comment-text').value.trim();
    if (!text) return;

    fetch(`/resources/comment/${resourceId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `text=${encodeURIComponent(text)}`
    })
    .then(res => res.json())
    .then(data => {
        const container = document.getElementById('comments-container');

        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `<strong>${data.username}</strong><br>${data.text}`;

        container.prepend(div);

        closeCommentModal();
    });
}
</script>


</body>
</html>
